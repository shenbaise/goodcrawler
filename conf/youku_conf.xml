<?xml version="1.0" encoding="UTF-8" ?>
<job>
	<name>movie</name>
	<!-- 表示爬虫运行指定的时间长度后自动结束  -->
	<jobtime>-1</jobtime>
	<!-- 表示抓取指定数量的Url后结束  -->
	<urlNum>-1</urlNum>
	<!-- 定义 Fetcher -->
	<fetch>
		<!-- 默认为Default，如果有其他实现，填写类的全路径 -->
		<type>default</type>
		<agent>Kindle</agent>
		<!-- 爬取线程数 -->
		<threadNum>4</threadNum>
		<!-- 同一线程两次请求之间的间隔 -->
		<delayBetweenRequests>50</delayBetweenRequests>
		<!-- Url爬取深度 -1表示不限深度 -->
		<maxDepthOfCrawling>-1</maxDepthOfCrawling>
		
		<maxOutgoingLinksToFollow>1000</maxOutgoingLinksToFollow>
		<!-- 是否下载二进制数据 -->
		<fetchBinaryContent>false</fetchBinaryContent>
		<!-- 下载文件的后缀 -->
		<fileSuffix>gif,jpg,png,zip,rar,aiv,mtk</fileSuffix>
		<maxDownloadSizePerPage>1048576</maxDownloadSizePerPage>
		<!-- 是否支持https -->
		<https>true</https>
		<!-- 是否仅爬取当前域名 -->
		<onlyDomain>true</onlyDomain>
		<connection>
			<!-- http链接超时时间 -->
			<socketTimeoutMilliseconds>20000</socketTimeoutMilliseconds>
			<!-- 从http链接池中获取到可用链接的超时时间 -->
			<connectionTimeout>2000</connectionTimeout>
			<maxTotalConnections>120</maxTotalConnections>
			<maxConnectionsPerHost>100</maxConnectionsPerHost>
		</connection>
		<!-- 代理设置 -->
		<proxy>
			<proxyHost></proxyHost>
			<proxyPort></proxyPort>
			<proxyUsername></proxyUsername>
			<proxyPassword></proxyPassword>
		</proxy>
		<!-- url种子 -->
		<seeds>
			<seed>http://www.youku.com/</seed>
		</seeds>
		<!-- 加入Url待处理队列的策略 -->
		<fetchUrlFilters>
			<!-- 
			<filter>http://.+[.]youku[.]com/.*[.]html$</filter>
			 -->
			<!-- 种子需要加入过滤策略 -->
			<filter>http://.*.youku.com/show_page/.*</filter>
			<filter>http://.*.youku.com/star_page/.*</filter>
			<filter>http://www.youku.com/</filter>
		</fetchUrlFilters>
		<!-- 加入待抽取信息页队列的策略 -->
		<extractUrlfilters>
			<filter>http://.*.youku.com/show_page/.*</filter>
			<filter>http://.*.youku.com/star_page/.*</filter>
		</extractUrlfilters>
	</fetch>

	<!-- 定义extract -->
	<extract> 
		<type>default</type>
		<threadNum>1</threadNum>
		<template name="movie">
			<urls>
				<url>http://.*.youku.com/show_page/.*</url>
			</urls>
			<elements>
				<element name="title" type="string" value=".title .name" attr="text" required="true" />
				<element name="category" type="string" value=".title .type a" attr="text" required="true">
					
					<if test="category=电影" ref="category">
						<element1 name="year" type="int" value=".title .pub" attr="text"/>
						<element1 name="score" type="int" value=".ratingstar .num" attr="text"/>
						<element1 name="alias" type="string" value=".alias" attr="text">
							<action1 opration="split" separator=":" retain="1"></action1>
						</element1>
						<element1 name="area" type="string" value=".row2 .area a" attr="text"/>
						<element1 name="lang" type="string" value=".lang" attr="text">
							<action1 opration="split" separator=":" retain="1"></action1>
						</element1>
						<element1 name="type" type="set" value=".row2 .type a" attr="text" required="true"/>
						<element1 name="director" type="string" value=".row2 .director a" attr="text" />
						<element1 name="actors" type="set" value=".actor a" attr="text" />
						<element1 name="duration" type="int" value=".row2 .duration" attr="text" />
						<element1 name="hot" type="int" value=".row2 .vr .num" attr="text" />
						<element1 name="summary" type="string" value=".detail .long" attr="text" />
						<element1 name="thumbnail" type="string" value=".baseinfo .thumb img" attr="src" required="true"/>
						
						<element1 name="play1" type="url" value=".btnplayposi" attr="href">
							<element2 name="online1" type="set" value="#link2" attr="value" />
						</element1>
						<element1 name="play2" type="url" value=".btnplaytrailer" attr="value">
							<element2 name="online2" type="set" value="#link2" attr="value" />
						</element1>
					</if>
					<if test="category=电视剧">
						<element1 name="year" type="int" value=".title .pub" attr="text" required="true"/>
						<element1 name="score" type="int" value=".ratingstar .num" attr="text"/>
						<element1 name="alias" type="string" value=".alias" attr="text">
							<action1 opration="split" separator=":" retain="1"></action1>
						</element1>
						<element1 name="area" type="string" value=".row2 .area a" attr="text"/>
						<element1 name="lang" type="string" value=".lang" attr="text">
							<action1 opration="split" separator=":" retain="1"></action1>
						</element1>
						<element1 name="type" type="set" value=".row2 .type a" attr="text" required="true"/>
						<element1 name="director" type="string" value=".row2 .director a" attr="text" />
						<element1 name="actors" type="set" value=".actor a" attr="text"/>
						<element1 name="hot" type="int" value=".row2 .vr .num" attr="text" />
						<element1 name="summary" type="string" value="#show_info_short" attr="text" />
						<element1 name="thumbnail" type="string" value=".baseinfo .thumb img" attr="src" required="true"/>
						<!-- 剧集超过40需要模拟点击 #研究中 -->
						<element1 name="play1" type="url" value="#episode a" attr="href">
							<element2 name="online" type="set" value="#link2" attr="value" />
						</element1>
					</if>
					<if test="category=综艺">
						<element1 name="year" type="int" value=".title .pub" attr="text"/>
						<element1 name="score" type="int" value=".ratingstar .num" attr="text" />
						<element1 name="area" type="string" value=".row2 .area a" attr="text" />
						<element1 name="type" type="set" value=".row1 .type .a" attr="text" required="true"/>
						<element1 name="lang" type="string" value=".lang" attr="text">
							<action1 opration="split" separator=":" retain="1"></action1>
						</element1>
						<element1 name="host" type="string" value=".row1 .host a" attr="text"/>
						<element1 name="hot" type="int" value=".row2 .vr .num" attr="text" />
						<element1 name="summary" type="string" value="#show_info_short" attr="text" />
						<element1 name="thumbnail" type="string" value=".baseinfo .thumb img" attr="src" required="true"/>
						<!-- 剧集超过40需要模拟点击 #研究中 -->
						<element1 name="play1" type="url" value="#episode a" attr="href">
							<element2 name="online" type="set" value="#link2" attr="value" />
						</element1>
					</if>
					<if test="category=动漫">
						<element1 name="year" type="int" value=".title .pub" attr="text" required="true"/>
						<element1 name="score" type="int" value=".ratingstar .num" attr="text"/>
						<element1 name="alias" type="string" value=".alias" attr="text">
							<action1 opration="split" separator=":" retain="1"></action1>
						</element1>
						<element1 name="area" type="string" value=".row2 .area a" attr="text"/>
						<element1 name="type" type="set" value=".row2 .type a" attr="text" required="true" />
						<element1 name="hot" type="int" value=".row2 .vr .num" attr="text" />
						<element1 name="summary" type="string" value=".detail .long" attr="text" />
						<element1 name="thumbnail" type="string" value=".baseinfo .thumb img" attr="src" required="true"/>
						<element1 name="play1" type="url" value="#episode a" attr="href">
							<element2 name="online" type="set" value="#link2" attr="value" />
						</element1>
					</if>
				</element>
			</elements>
		</template>
	</extract>
	<!-- 存储配置 -->
	<store>
		<type>elasticsearch</type>
		<threadNum>2</threadNum>
	</store>
</job>